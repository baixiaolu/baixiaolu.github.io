import{_ as p,r as t,o as e,c as i,a as n,d as s,b as o,e as c}from"./app-RLcf5AN2.js";const l={},u=c('<h1 id="mysql命令进阶" tabindex="-1"><a class="header-anchor" href="#mysql命令进阶" aria-hidden="true">#</a> MySQL命令进阶</h1><h2 id="_1-union-实现多级联查的表整成一个自关联表" tabindex="-1"><a class="header-anchor" href="#_1-union-实现多级联查的表整成一个自关联表" aria-hidden="true">#</a> 1. UNION 实现多级联查的表整成一个自关联表</h2><p>需求：园区、片区、楼栋、楼层、空间五个表整合成一张自关联表</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_park<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_park<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>park_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_park<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>label<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token number">0</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token string">&#39;8EADB678-A646-1E51-3E87-75A547B8AF19&#39;</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>org_id<span class="token punctuation">`</span></span> \n<span class="token keyword">FROM</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_park<span class="token punctuation">`</span></span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>\n<span class="token keyword">SELECT</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_area<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_area<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>area_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_area<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>label<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_area<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>park_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token string">&#39;8EADB678-A646-1E51-3E87-75A547B8AF19&#39;</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>org_id<span class="token punctuation">`</span></span> \n<span class="token keyword">FROM</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_area<span class="token punctuation">`</span></span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>\n<span class="token keyword">SELECT</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_building<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_building<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>building_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_building<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>label<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_building<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>area_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token string">&#39;8EADB678-A646-1E51-3E87-75A547B8AF19&#39;</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>org_id<span class="token punctuation">`</span></span> \n<span class="token keyword">FROM</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_building<span class="token punctuation">`</span></span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>\n<span class="token keyword">SELECT</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_floor<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_floor<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>floor_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_floor<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>floor<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>label<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_floor<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>building_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token string">&#39;8EADB678-A646-1E51-3E87-75A547B8AF19&#39;</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>org_id<span class="token punctuation">`</span></span> \n<span class="token keyword">FROM</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_floor<span class="token punctuation">`</span></span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>\n<span class="token keyword">SELECT</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_space<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_space<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>space_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>uid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_space<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>room<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>label<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_space<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>floor_id<span class="token punctuation">`</span></span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>pid<span class="token punctuation">`</span></span><span class="token punctuation">,</span>\n	<span class="token string">&#39;8EADB678-A646-1E51-3E87-75A547B8AF19&#39;</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>org_id<span class="token punctuation">`</span></span> \n<span class="token keyword">FROM</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ici_ai_space<span class="token punctuation">`</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-某表中多个id对应同一个表的联查" tabindex="-1"><a class="header-anchor" href="#_2-某表中多个id对应同一个表的联查" aria-hidden="true">#</a> 2. 某表中多个id对应同一个表的联查</h2><p>需求：园区表中的省、市、区id均对应base_city表，要求联查出省、市、区名称</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> \npark<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>\np<span class="token punctuation">.</span>city_name <span class="token keyword">as</span> province_name<span class="token punctuation">,</span>\nc<span class="token punctuation">.</span>city_name <span class="token keyword">as</span> city_name<span class="token punctuation">,</span>\nd<span class="token punctuation">.</span>city_name <span class="token keyword">as</span> district_name\n\n<span class="token keyword">from</span> ici_ai_park park\n\n<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> base_city <span class="token keyword">as</span> p <span class="token keyword">on</span> park<span class="token punctuation">.</span>province_id <span class="token operator">=</span> p<span class="token punctuation">.</span>id\n<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> base_city <span class="token keyword">as</span> c <span class="token keyword">on</span> park<span class="token punctuation">.</span>city_id <span class="token operator">=</span> c<span class="token punctuation">.</span>id\n<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> base_city <span class="token keyword">as</span> d <span class="token keyword">on</span> park<span class="token punctuation">.</span>district_id <span class="token operator">=</span> d<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="开窗函数" tabindex="-1"><a class="header-anchor" href="#开窗函数" aria-hidden="true">#</a> 开窗函数</h2><p>需求：按每个空间查询最新的入住记录，关联到空间表中，并查询出该空间的楼栋信息</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>\n	building<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>\n	space<span class="token punctuation">.</span><span class="token operator">*</span> \n<span class="token keyword">FROM</span>\n	ici_ai_space space\n	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ici_ai_building <span class="token keyword">AS</span> building <span class="token keyword">ON</span> space<span class="token punctuation">.</span>building_id <span class="token operator">=</span> building<span class="token punctuation">.</span>id\n	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span>\n	<span class="token keyword">SELECT</span>\n		<span class="token operator">*</span> \n	<span class="token keyword">FROM</span>\n		<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span> <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> space_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">DESC</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> rownumber <span class="token keyword">FROM</span> ici_space_checkin <span class="token punctuation">)</span> checkin \n	<span class="token keyword">WHERE</span>\n		checkin<span class="token punctuation">.</span>rownumber <span class="token operator">=</span> <span class="token number">1</span> \n	<span class="token punctuation">)</span> <span class="token keyword">AS</span> last_checkin <span class="token keyword">ON</span> last_checkin<span class="token punctuation">.</span>space_id <span class="token operator">=</span> space<span class="token punctuation">.</span>id \n<span class="token keyword">WHERE</span>\n	space<span class="token punctuation">.</span>building_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>开窗函数说明：<code>row_number() over (PARTITION BY space_id ORDER BY id DESC) AS rownumber</code>，以<code>space_id</code>为分组依据，按<code>id</code>倒序排列，并返回第1个记录的行号，即最新入住记录的行号，然后再关联到空间表中，并查询出该空间的楼栋信息</p>',11),k={href:"https://zhuanlan.zhihu.com/p/484290987",target:"_blank",rel:"noopener noreferrer"};function d(r,v){const a=t("ExternalLinkIcon");return e(),i("div",null,[u,n("p",null,[s("参考资料："),n("a",k,[s("SQL进阶-开窗函数() over(partition by)"),o(a)])])])}const b=p(l,[["render",d],["__file","index.html.vue"]]);export{b as default};
